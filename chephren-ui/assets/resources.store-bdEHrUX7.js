var O=Object.defineProperty;var U=(n,a,i)=>a in n?O(n,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[a]=i;var m=(n,a,i)=>(U(n,typeof a!="symbol"?a+"":a,i),i);import{d as V,a as h,b as w,u as D,F as k,j as M,t as j,r as q,o as y,bV as J,f as P,w as R,e as A,k as G,_ as K,bW as W,h as C,c as S,K as z,T as p}from"./index-KEx3fXyj.js";import{u as H}from"./nodes.store-yGROBZVh.js";const Q={class:"breadcrumb"},X=["path"],Y={key:0},Z=V({__name:"BreadcrumbComponent",props:{items:{type:Array,required:!0},lastItemLabel:{type:String,required:!0}},setup(n){return(a,i)=>{const g=q("router-link");return y(),h("div",Q,[w("button",null,[w("svg-icon",{path:D(J),type:"mdi",onClick:i[0]||(i[0]=c=>a.$router.back())},null,8,X)]),(y(!0),h(k,null,M(n.items,(c,d)=>(y(),h(k,{key:c.route},[w("span",null,[P(g,{to:c.route},{default:R(()=>[A(j(c.label),1)]),_:2},1032,["to"])]),d<n.items.length?(y(),h("span",Y,"/")):G("",!0)],64))),128)),w("span",null,j(n.lastItemLabel),1)])}}}),se=K(Z,[["__scopeId","data-v-6d0135bd"]]);class v{constructor(a){m(this,"id");m(this,"name");m(this,"lastUpdate");m(this,"commands");m(this,"commandsCount");Object.assign(this,a)}}const te=W("resources",()=>{const n="/api/resources",a="/api/resource",i=H(),g=e=>`/api/resource/${e}`,c=C(new Map),d=C(new Map);async function T(e,s){const r=await fetch(`${e.address}${a}/${s}`,{method:"GET"});if(!r.ok)throw new Error(await r.json());const t=await r.json();return{resource:new v(t),node:e,checked:!1}}async function _(e,s=!1){if(s&&d.value.delete(e),d.value.has(e))return;const{nodes:r}=z(i);if(!r.value&&(await i.fetchNodes(),!r.value))return;const t=[],o=[];for(const u of r.value){const l=T(u,e);o.push(l)}const f=await Promise.allSettled(o);for(const u of f)if(u.status==="fulfilled"){const l=u.value;t.push(l)}d.value.set(e,t)}async function $(e,s=!1){if(s&&b(),!c.value.has(e.id))try{const r=await fetch(`${e.address}${n}`,{method:"GET"});if(!r.ok){p.addError(`Failed to fetch resources from ${e.name}`,r.statusText),console.error(`Failed to fetch resources from ${e.name}`,r);return}const t=await r.json();c.value.set(e.id,t.map(o=>new v(o)))}catch(r){p.addError(`Failed to fetch resources from ${e.name}`,r.message),console.error(`Failed to fetch resources from ${e.name}`,r);return}}async function N(e,s,r=[],t=!1){var o,f;if(c.value.has(e.id))try{const u=await fetch(`${e.address}${a}/${s}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({addresses:r})});if(!u.ok){const E=await u.json();throw new Error(E.message)}const l=(o=c.value.get(e.id))==null?void 0:o.find(E=>E.id===s);(f=l==null?void 0:l.commands)==null||f.push({command:"DELETE",date:new Date,id:"0"}),t&&await $(e,!0)}catch(u){console.error(u),p.addError("Error deleting resource",u.message)}}async function x(e,s,r){const t=g(s.id);try{const o=await fetch(`${e.address}${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:r.command,addresses:r.addresses??[]})});if(!o.ok){const f=await o.json();throw new Error(f.message)}s.commandsCount??(s.commandsCount=1),s.commandsCount+=1}catch(o){throw console.error(o),p.addError("Error updating resource",o.message),o}}async function F(e,s){var r;if(!s.name||!s.command)throw new Error("Name and command are required");s.addresses??(s.addresses=[]);try{const t=await fetch(`${e.address}${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!t.ok){const o=await t.json();throw new Error(o.message)}e.resourcesCount??(e.resourcesCount=0),e.resourcesCount+=1,(r=c.value.get(e.id))==null||r.push(new v(await t.json()))}catch(t){throw p.addError("Error creating resource",t.message),console.error(t),t}}function b(){d.value.clear(),c.value.clear()}const B=S(()=>e=>d.value.get(e)),L=S(()=>e=>c.value.get(e));return{occurences:B,resources:L,fetchResourcesForNode:$,fetchResourceOccurences:_,clearResources:b,deleteResource:N,updateResource:x,createResource:F}});export{se as B,te as u};
