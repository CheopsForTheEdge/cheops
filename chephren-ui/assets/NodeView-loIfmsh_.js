var he=Object.defineProperty;var fe=(a,p,d)=>p in a?he(a,p,{enumerable:!0,configurable:!0,writable:!0,value:d}):a[p]=d;var F=(a,p,d)=>(fe(a,typeof p!="symbol"?p+"":p,d),d);import{d as x,h as k,p as I,D as be,a as h,b as o,k as $,F as q,j as B,n as A,E as ke,o as u,t as _,_ as U,g as w,A as se,B as Ce,u as R,m as te,G as _e,H as ge,I as ye,J as Se,e as L,w as S,T as y,f as g,y as ne,z as de,K as ae,c as K,L as we,M as Ve,N as oe,O as $e,v as Ne}from"./index-KEx3fXyj.js";import{u as J,B as Me}from"./resources.store-bdEHrUX7.js";import{B as T}from"./ButtonComponent-psMr_FlM.js";import{u as De,L as G}from"./nodesUrl.store-PYa8P4uy.js";import{T as H}from"./TextInput-dCpX3Klo.js";import{M as Q}from"./ModalComponent-ThZEBNm4.js";import{u as Ee,S as D}from"./nodes.store-yGROBZVh.js";const Re={key:0},xe=["onMousedown"],Ie=x({__name:"DatalistComponent",props:{autoCompleteData:{type:Array,required:!1,default:()=>[]},autoCompleteStyle:{type:Object,required:!0},isOpen:{type:Boolean,required:!0},position:{type:String,required:!0},select:{type:String,default:"value",required:!1}},emits:{onSelect:a=>a},setup(a,{emit:p}){const d=a,i=p,l=k(null),e=t=>{i("onSelect",t),l.value=null},r=t=>{var s;if(d.isOpen)switch(t.key){case"ArrowUp":f();break;case"ArrowDown":m();break;case"Enter":c();break;case"Escape":(s=document.activeElement)==null||s.blur();break}},m=()=>{l.value===null?l.value=0:l.value<d.autoCompleteData.length-1?l.value+=1:l.value>=d.autoCompleteData.length-1&&(l.value=d.autoCompleteData.length-1);const t=document.querySelector(".selected");t&&t.scrollIntoView({block:"start"})},f=()=>{l.value===null?l.value=d.autoCompleteData.length-1:l.value>0?l.value-=1:l.value<=0&&(l.value=0);const t=document.querySelector(".selected");t&&t.scrollIntoView({block:"end"})},c=()=>{l.value!==null&&e(d.autoCompleteData[l.value])};return I(()=>{window.addEventListener("keydown",r)}),be(()=>{window.removeEventListener("keydown",r)}),(t,s)=>(u(),h("div",{class:A(["datalist",a.position]),style:ke(a.autoCompleteStyle)},[o("ul",null,[a.autoCompleteData.length===0?(u(),h("li",Re,"No results")):$("",!0),(u(!0),h(q,null,B(a.autoCompleteData,(C,V)=>(u(),h("li",{key:C.value,class:A({selected:V===l.value})},[o("button",{onMousedown:P=>e(C)},_(C.label),41,xe)],2))),128))])],6))}}),le=U(Ie,[["__scopeId","data-v-13f98420"]]),Ue={class:"autocomplete-container"},Oe={class:"label"},Le={class:"buttons"},qe=["path"],Te=["path"],Ae=x({__name:"AutoCompleteInput",props:{label:{type:String,required:!0},autoCompletePosition:{type:String,required:!1,default:"bottom"},autoCompleteData:{type:Array,required:!1,default:()=>[]},select:{type:String,default:"value",required:!1}},emits:["selected"],setup(a,{emit:p}){const d={maxHeight:"100px",border:"1px solid var(--primary)"},i={maxHeight:"0",border:"none"},l=a,e=p,r=k(""),m=k(i),f=k([]),c=k(!1),t=k(!1),s=N=>{r.value=N.label,c.value=!0;const O=l.select==="label"?N.label:N.value;e("selected",O)},C=()=>{r.value="",c.value=!1,e("selected")},V=()=>{t.value=!0,m.value=d},P=()=>{t.value=!1,m.value=i},z=()=>{f.value=l.autoCompleteData.filter(N=>N.label.toLowerCase().includes(r.value.toLowerCase()))};return I(()=>{f.value=l.autoCompleteData}),(N,O)=>(u(),h("div",Ue,[a.autoCompleteData.length>0&&a.autoCompletePosition==="top"?(u(),w(le,{key:0,"auto-complete-data":f.value,"auto-complete-style":m.value,"is-open":t.value,position:a.autoCompletePosition,select:a.select,onOnSelect:s},null,8,["auto-complete-data","auto-complete-style","is-open","position","select"])):$("",!0),c.value?(u(),h("div",{key:2,class:"valid-data-container",onClick:C},[o("span",null,_(r.value),1),o("svg-icon",{type:"mdi",path:R(te)},null,8,Te)])):(u(),h("div",{key:1,class:A(["input-container",a.autoCompletePosition])},[o("label",Oe,[se(o("input",{class:"input",type:"text",placeholder:"toto","onUpdate:modelValue":O[0]||(O[0]=W=>r.value=W),onInput:z,onFocus:V,onBlur:P},null,544),[[Ce,r.value]]),o("span",null,_(a.label),1)]),o("div",Le,[r.value?(u(),h("button",{key:0,onClick:C},[o("svg-icon",{type:"mdi",path:R(te)},null,8,qe)])):$("",!0)])],2)),a.autoCompleteData.length>0&&a.autoCompletePosition==="bottom"?(u(),w(le,{key:3,"auto-complete-data":f.value,"auto-complete-style":m.value,"is-open":t.value,position:a.autoCompletePosition,select:a.select,onOnSelect:s},null,8,["auto-complete-data","auto-complete-style","is-open","position","select"])):$("",!0)]))}}),Be=U(Ae,[["__scopeId","data-v-2f71ee1a"]]),Pe=["id","value","disabled"],je=["for"],Fe=x({__name:"CheckboxComponent",props:_e({id:{type:String,required:!0},value:{type:String,required:!0},disabled:{type:Boolean,default:!1},initialValue:{type:Boolean,default:!1}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const p=a;I(()=>{d.value=p.initialValue});const d=ge(a,"modelValue");return(i,l)=>(u(),h("div",{class:A(["checkbox-container",{checked:d.value}])},[se(o("input",{type:"checkbox",id:a.id,"onUpdate:modelValue":l[0]||(l[0]=e=>d.value=e),value:a.value,disabled:a.disabled},null,8,Pe),[[ye,d.value]]),o("label",{for:a.id},[Se(i.$slots,"default",{},()=>[L(_(a.id),1)],!0)],8,je)],2))}}),X=U(Fe,[["__scopeId","data-v-3578e4c3"]]),Ge=a=>(ne("data-v-35c6a573"),a=a(),de(),a),He={class:"form"},ze=Ge(()=>o("h3",null,"Create this resource on other nodes :",-1)),We={class:"checkbox-list"},Ke={class:"label-container"},Ye=x({__name:"CreateResourceModalComponent",props:{node:{type:Object,required:!0}},emits:["closeModal"],setup(a,{emit:p}){const d=a,i=p,l=De(),e=k({}),r=k([]),m=f=>{if(!f){i("closeModal",!1);return}const c=[];if(e.value.command||c.push("command"),e.value.name||c.push("name"),c.length>0){y.addWarning(`Some attributes are mandatory : ${c.join(", ")}`);return}const t=r.value.filter(s=>s.checked);if(t.length===0){y.addWarning("You must select at least one node to create this resource");return}e.value.addresses=t.filter(s=>!s.url.isNode(d.node)).map(s=>s.url.url),i("closeModal",!0,e.value)};return I(()=>{r.value=l.getNodeUrls().map(f=>({url:f,checked:!1}))}),(f,c)=>(u(),w(Q,{class:"modal",headerText:"Create a resource",onCloseModal:m},{default:S(()=>[o("div",He,[g(H,{modelValue:e.value.name,"onUpdate:modelValue":c[0]||(c[0]=t=>e.value.name=t),label:"Name"},null,8,["modelValue"]),g(H,{modelValue:e.value.command,"onUpdate:modelValue":c[1]||(c[1]=t=>e.value.command=t),label:"Command"},null,8,["modelValue"]),ze,o("div",We,[(u(!0),h(q,null,B(r.value,t=>(u(),w(X,{key:t.url.hash,modelValue:t.checked,"onUpdate:modelValue":s=>t.checked=s,value:t.url.hash,id:t.url.hash,disabled:t.url.isNode(a.node),"initial-value":t.url.isNode(a.node)},{default:S(()=>[o("div",Ke,[o("span",null,_(t.url.name),1),o("span",null,_(t.url.url),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","value","id","disabled","initial-value"]))),128))])])]),_:1}))}}),Je=U(Ye,[["__scopeId","data-v-35c6a573"]]);class Qe{constructor(){F(this,"command");F(this,"addresses");this.command="",this.addresses=[]}}const Xe={key:0,class:"loading-modal"},Ze={class:"label-container"},et=x({__name:"DeleteResourceModalComponent",props:{resource:{type:Object,required:!0},node:{type:Object,required:!0}},emits:["closeModal"],setup(a,{emit:p}){const d=J(),i=a,l=p,e=k(!1),r=k(),m=f=>{var t;if(!f){l("closeModal",!1);return}const c=((t=r.value)==null?void 0:t.filter(s=>s.node.id!==i.node.id).filter(s=>s.checked).map(s=>s.node.address))??[];l("closeModal",!0,i.resource.id,c)};return I(()=>{e.value=!0,d.fetchResourceOccurences(i.resource.id).then(()=>{r.value=d.occurences(i.resource.id),e.value=!1})}),(f,c)=>(u(),w(Q,{class:"modal",headerText:"On which node do you want to delete this resource?",onCloseModal:m},{default:S(()=>[e.value?(u(),h("div",Xe,[g(G,{label:"Loading nodes"})])):(u(!0),h(q,{key:1},B(r.value,t=>(u(),h("div",{key:t.node.id,class:"checkbox-list"},[g(X,{value:t.node.id,id:t.node.id,modelValue:t.checked,"onUpdate:modelValue":s=>t.checked=s,disabled:t.node.id===a.node.id,"initial-value":t.node.id===a.node.id},{default:S(()=>[o("div",Ze,[o("span",null,_(t.node.name),1),o("span",null,_(t.node.address),1)])]),_:2},1032,["value","id","modelValue","onUpdate:modelValue","disabled","initial-value"])]))),128))]),_:1}))}}),tt=U(et,[["__scopeId","data-v-d02abdcd"]]),at={key:0,class:"loading-modal"},ot={key:1,class:"form"},lt={class:"checkbox-list"},st={class:"label-container"},nt=x({__name:"EditResourceModalComponent",props:{resource:{type:Object,required:!0},node:{type:Object,required:!0}},emits:["closeModal"],setup(a,{emit:p}){const d=a,i=p,l=J(),e=k(!1),r=k(""),m=k(),f=c=>{var s;if(!c){i("closeModal",!1);return}const t=new Qe;t.command=r.value,t.addresses=((s=m.value)==null?void 0:s.filter(C=>C.node.id!==d.node.id).filter(C=>C.checked).map(C=>C.node.address))??[],i("closeModal",!0,t)};return I(()=>{e.value=!0,l.fetchResourceOccurences(d.resource.id).then(()=>{m.value=l.occurences(d.resource.id),e.value=!1})}),(c,t)=>(u(),w(Q,{class:"modal",headerText:"Edit resource",onCloseModal:f},{default:S(()=>[e.value?(u(),h("div",at,[g(G,{label:"Loading nodes"})])):(u(),h("div",ot,[g(H,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s),label:"Command"},null,8,["modelValue"]),o("h3",null,'Edit resource "'+_(a.resource.name)+'" on other nodes :',1),o("div",lt,[(u(!0),h(q,null,B(m.value,s=>(u(),w(X,{key:s.node.id,modelValue:s.checked,"onUpdate:modelValue":C=>s.checked=C,value:s.node.id,id:s.node.id,disabled:s.node.id===a.node.id,"initial-value":s.node.id===a.node.id},{default:S(()=>[o("div",st,[o("span",null,_(s.node.name),1),o("span",null,_(s.node.address),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","value","id","disabled","initial-value"]))),128))])]))]),_:1}))}}),dt=U(nt,[["__scopeId","data-v-85111d62"]]);class Y{static async ping(p,d){const i=`${p.address}${this.url}`;try{const l=await fetch(i,{method:"GET",headers:{addresses:d.map(r=>r.address.toString()).join(",")}}),e=await l.json();if(l.ok){const r=[];for(const m of d)r.push({node:m,reachable:e.results[m.address.toString()]});return{reachable:e.reachable,results:r}}throw new Error(e.message)}catch(l){return console.error(`Error pinging node ${p.name} at ${i}: ${l}`),{reachable:!1,results:[]}}}}F(Y,"url","/api/ping");const Z=a=>(ne("data-v-a9e9a059"),a=a(),de(),a),ut={class:"page"},rt={class:"page-header"},it={class:"left"},ct={class:"node-address"},mt={class:"right"},vt={class:"page-content"},pt={class:"content-header"},ht=Z(()=>o("span",null,"Resources",-1)),ft={class:"table-container"},bt={"aria-label":"List of resources with last update"},kt=Z(()=>o("thead",null,[o("tr",null,[o("th",null,"Name"),o("th",null,"Last update"),o("th",null,"Actions")])],-1)),Ct=["onClick"],_t={class:"actions"},gt=["onClick"],yt=["path"],St=["onClick"],wt=["path"],Vt={key:0},$t={colspan:"3",style:{position:"relative",height:"200px"}},Nt={key:1,class:"no-data"},Mt=Z(()=>o("td",{colspan:"3"},[o("span",null,"No resources found")],-1)),Dt=[Mt],Et={class:"page-footer"},Rt=x({__name:"NodeView",setup(a){const p=we(),d=Ve(),i=Ee(),l=J(),e=k(),{nodesName:r}=ae(i),m=k(),f=K(()=>{var n;return l.resources(((n=e.value)==null?void 0:n.id)??"")??[]}),c=k(!1),t=k(),s=k(),C=k(!1),V=k(""),P=()=>{const n=p.params.id;if(!n||Array.isArray(n)){d.push({name:"home"});return}if(e.value=i.getNodeById(n),!e.value){d.push({name:"home"});return}e.value.state===D.OFFLINE&&y.addError("Node is offline",(e.value.name??"Unknown name")+". This page can be outdated."),e.value.state===D.UNKNOWN&&y.addError("Node has an unknown state",(e.value.name??"Unknown name")+". This page can be outdated.")},z=n=>{var v;d.push({name:"resource",params:{nodeId:(v=e.value)==null?void 0:v.id,resourceId:n.id}})},N=n=>{if(!n){m.value=void 0;return}m.value=i.getNodeById(n)},O=()=>{!e.value||!m.value||Y.ping(e.value,[m.value]).then(n=>{n.results&&(n.results[0].reachable?y.addSuccess("Ping result",`${m.value.name} is reachable`):y.addError("Ping result",`${m.value.name} is unreachable`))})},W=()=>{if(!e.value)return;const{nodes:n}=ae(i);n.value&&Y.ping(e.value,n.value).then(v=>{if(v.results){const b=v.results.filter(E=>E.reachable).map(E=>E.node.name),M=v.results.filter(E=>!E.reachable).map(E=>E.node.name);b.length>0&&y.addSuccess("Ping result",`Reachable nodes: ${b.join(", ")}`),M.length>0&&y.addError("Ping result",`Unreachable nodes: ${M.join(", ")}`)}})},ue=K(()=>!V.value||V.value.trim()===""?f.value:f.value.filter(n=>n.name.toLowerCase().includes(V.value.toLowerCase()))),j=K(()=>{var n,v,b,M;return((n=e.value)==null?void 0:n.state)===D.OFFLINE?{label:"Start node",disabled:!1,background:"green",actions:i.startNode}:((v=e.value)==null?void 0:v.state)===D.ONLINE?{label:"Stop node",disabled:!1,background:"red",actions:i.stopNode}:((b=e.value)==null?void 0:b.state)===D.STARTING?{label:"Starting...",disabled:!0,background:"yellow",actions:()=>{}}:((M=e.value)==null?void 0:M.state)===D.STOPPING?{label:"Stopping...",disabled:!0,background:"yellow",actions:()=>{}}:{label:"Unknown",disabled:!0,background:"cuisse",actions:()=>{y.addDev("Unknown state","This should not happen. You break the universe.")}}}),re=n=>{s.value=n},ie=(n,v,b)=>{s.value=void 0,n&&v&&l.deleteResource(e.value,v,b).then(()=>{y.addSuccess("Resource deleted")})},ee=n=>{c.value=!0,l.fetchResourcesForNode(e.value,n).then(()=>{c.value=!1})},ce=n=>{t.value=n},me=(n,v)=>{const b=t.value;t.value=void 0,n&&v&&b&&l.updateResource(e.value,b,v).then(()=>{y.addSuccess("Resource updated")})},ve=()=>{C.value=!0},pe=(n,v)=>{C.value=!1,n&&v&&l.createResource(e.value,v).then(()=>{y.addSuccess("Resource created")})};return I(()=>{i.fetchNodes().then(()=>{P(),ee(!1)})}),(n,v)=>(u(),h("div",ut,[e.value?(u(),h(q,{key:0},[o("div",rt,[o("div",it,[g(Me,{items:[{label:"Nodes",route:{name:"home"}}],"last-item-label":e.value.name??"Unknown name"},null,8,["last-item-label"]),o("span",ct,_(e.value.address),1)]),o("div",mt,[g(T,{disabled:e.value.state!==R(D).ONLINE,onClick:ve},{default:S(()=>[L(" Create resource ")]),_:1},8,["disabled"]),g(T,{disabled:e.value.state!==R(D).ONLINE,onClick:v[0]||(v[0]=b=>ee(!0))},{default:S(()=>[L(" Refresh ")]),_:1},8,["disabled"]),g(T,{disabled:j.value.disabled,background:j.value.background,onClick:v[1]||(v[1]=b=>j.value.actions(e.value.id))},{default:S(()=>[L(_(j.value.label),1)]),_:1},8,["disabled","background"]),o("span",{class:A(e.value.state)},_(e.value.state),3)])]),o("div",vt,[o("div",pt,[ht,g(H,{label:"Search resources",modelValue:V.value,"onUpdate:modelValue":v[2]||(v[2]=b=>V.value=b)},null,8,["modelValue"])]),o("div",ft,[o("table",bt,[kt,o("tbody",null,[(u(!0),h(q,null,B(ue.value,b=>(u(),h("tr",{key:b.name,onClick:M=>z(b)},[o("td",null,_(b.name),1),o("td",null,_(n.$filters.longDate(b.lastUpdate)),1),o("td",null,[o("div",_t,[o("button",{"aria-label":"Edit resource",class:"edit",onClick:oe(M=>ce(b),["stop"])},[o("svg-icon",{path:R($e),type:"mdi"},null,8,yt)],8,gt),o("button",{"aria-label":"Delete resource",class:"delete",onClick:oe(M=>re(b),["stop"])},[o("svg-icon",{path:R(Ne),type:"mdi"},null,8,wt)],8,St)])])],8,Ct))),128)),f.value.length===0&&c.value?(u(),h("tr",Vt,[o("td",$t,[g(G,{label:"Loading resources"})])])):$("",!0),f.value.length===0&&!c.value?(u(),h("tr",Nt,Dt)):$("",!0)])])])]),o("div",Et,[g(Be,{label:"Node to ping","auto-complete-data":R(r),"auto-complete-position":"top",onSelected:N},null,8,["auto-complete-data"]),g(T,{disabled:!m.value,onClick:O},{default:S(()=>[L("Ping selected")]),_:1},8,["disabled"]),g(T,{onClick:W},{default:S(()=>[L("Ping all nodes")]),_:1})])],64)):(u(),w(G,{key:1,label:"Loading node"})),e.value&&s.value?(u(),w(tt,{key:2,resource:s.value,node:e.value,onCloseModal:ie},null,8,["resource","node"])):$("",!0),e.value&&t.value?(u(),w(dt,{key:3,resource:t.value,node:e.value,onCloseModal:me},null,8,["resource","node"])):$("",!0),e.value&&C.value?(u(),w(Je,{key:4,node:e.value,onCloseModal:pe},null,8,["node"])):$("",!0)]))}}),Bt=U(Rt,[["__scopeId","data-v-a9e9a059"]]);export{Bt as default};
