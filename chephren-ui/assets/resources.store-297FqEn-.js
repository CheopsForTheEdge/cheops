var L=Object.defineProperty;var U=(n,t,u)=>t in n?L(n,t,{enumerable:!0,configurable:!0,writable:!0,value:u}):n[t]=u;var i=(n,t,u)=>(U(n,typeof t!="symbol"?t+"":t,u),u);import{d as V,a as p,b as w,u as q,F as C,j as D,t as j,r as M,o as y,bV as J,f as P,w as R,e as A,k as G,_ as K,bW as W,h as k,c as S,K as z,T as h}from"./index-S3zfWH4n.js";import{u as H}from"./nodes.store-C9o8b4n8.js";const Q={class:"breadcrumb"},X=["path"],Y={key:0},Z=V({__name:"BreadcrumbComponent",props:{items:{type:Array,required:!0},lastItemLabel:{type:String,required:!0}},setup(n){return(t,u)=>{const g=M("router-link");return y(),p("div",Q,[w("button",null,[w("svg-icon",{path:q(J),type:"mdi",onClick:u[0]||(u[0]=c=>t.$router.back())},null,8,X)]),(y(!0),p(C,null,D(n.items,(c,l)=>(y(),p(C,{key:c.route},[w("span",null,[P(g,{to:c.route},{default:R(()=>[A(j(c.label),1)]),_:2},1032,["to"])]),l<n.items.length?(y(),p("span",Y,"/")):G("",!0)],64))),128)),w("span",null,j(n.lastItemLabel),1)])}}}),te=K(Z,[["__scopeId","data-v-6d0135bd"]]);class I{constructor(t){i(this,"id");i(this,"command");i(this,"date");Object.assign(this,t)}equals(t){return this.id===t.id}}class oe{constructor(){i(this,"command");i(this,"addresses");this.command="",this.addresses=[]}}class v{constructor(t){i(this,"id");i(this,"name");i(this,"lastUpdate");i(this,"commands");i(this,"commandsCount");i(this,"deleted");Object.assign(this,t)}}const ae=W("resources",()=>{const n="/api/resources",t="/api/resource",u=H(),g=e=>`/api/resource/${e}`,c=k(new Map),l=k(new Map);async function T(e,r){const s=await fetch(`${e.address}${t}/${r}`,{method:"GET"});if(!s.ok)throw new Error(await s.json());const o=await s.json();return{resource:new v(o),node:e,checked:!1}}async function _(e,r=!1){if(r&&l.value.delete(e),l.value.has(e))return;const{nodes:s}=z(u);if(!s.value&&(await u.fetchNodes(),!s.value))return;const o=[],a=[];for(const d of s.value){const m=T(d,e);a.push(m)}const f=await Promise.allSettled(a);for(const d of f)if(d.status==="fulfilled"){const m=d.value;o.push(m)}l.value.set(e,o)}async function $(e,r=!1){if(r&&b(),!c.value.has(e.id))try{const s=await fetch(`${e.address}${n}`,{method:"GET"});if(!s.ok){h.addError(`Failed to fetch resources from ${e.name}`,s.statusText),console.error(`Failed to fetch resources from ${e.name}`,s);return}const o=await s.json();c.value.set(e.id,o.map(a=>new v(a)))}catch(s){h.addError(`Failed to fetch resources from ${e.name}`,s.message),console.error(`Failed to fetch resources from ${e.name}`,s);return}}async function N(e,r,s=[],o=!1){var a,f;if(c.value.has(e.id))try{const d=await fetch(`${e.address}${t}/${r}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({addresses:s})});if(!d.ok){const E=await d.json();throw new Error(E.message)}const m=(a=c.value.get(e.id))==null?void 0:a.find(E=>E.id===r);m&&(m.deleted=!0,(f=m.commands)==null||f.push(new I({command:"DELETE",date:new Date,id:"0"}))),o&&await $(e,!0)}catch(d){console.error(d),h.addError("Error deleting resource",d.message)}}async function x(e,r,s){const o=g(r.id);try{const a=await fetch(`${e.address}${o}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:s.command,addresses:s.addresses??[]})});if(!a.ok){const f=await a.json();throw new Error(f.message)}r.commandsCount??(r.commandsCount=1),r.commandsCount+=1}catch(a){throw console.error(a),h.addError("Error updating resource",a.message),a}}async function F(e,r){var s;if(!r.name||!r.command)throw new Error("Name and command are required");r.addresses??(r.addresses=[]);try{const o=await fetch(`${e.address}${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!o.ok){const a=await o.json();throw new Error(a.message)}e.resourcesCount??(e.resourcesCount=0),e.resourcesCount+=1,(s=c.value.get(e.id))==null||s.push(new v(await o.json()))}catch(o){throw h.addError("Error creating resource",o.message),console.error(o),o}}function b(){l.value.clear(),c.value.clear()}const O=S(()=>e=>l.value.get(e)),B=S(()=>e=>c.value.get(e));return{occurences:O,resources:B,fetchResourcesForNode:$,fetchResourceOccurences:_,clearResources:b,deleteResource:N,updateResource:x,createResource:F}});export{te as B,oe as N,ae as u};
