var pe=Object.defineProperty;var he=(a,p,d)=>p in a?pe(a,p,{enumerable:!0,configurable:!0,writable:!0,value:d}):a[p]=d;var ee=(a,p,d)=>(he(a,typeof p!="symbol"?p+"":p,d),d);import{d as x,h as k,p as E,D as fe,a as f,b as l,k as $,F as q,j as T,n as A,E as be,o as u,t as _,_ as I,g as w,A as se,B as ke,u as R,m as te,G as Ce,H as _e,I as ge,J as ye,e as O,w as S,T as y,f as g,y as ne,z as de,c as F,K as ae,L as Se,M as we,N as le,O as Ve,v as $e}from"./index-S3zfWH4n.js";import{u as J,N as Me,B as Ne}from"./resources.store-297FqEn-.js";import{B}from"./ButtonComponent-Pwr4QGq4.js";import{u as De,L as G}from"./nodesUrl.store-PXBot1Sw.js";import{T as H}from"./TextInput-l54gc_wS.js";import{M as K}from"./ModalComponent-9h5liNC-.js";import{u as Re,S as L}from"./nodes.store-C9o8b4n8.js";const xe={key:0},Ee=["onMousedown"],Ie=x({__name:"DatalistComponent",props:{autoCompleteData:{type:Array,required:!1,default:()=>[]},autoCompleteStyle:{type:Object,required:!0},isOpen:{type:Boolean,required:!0},position:{type:String,required:!0},select:{type:String,default:"value",required:!1}},emits:{onSelect:a=>a},setup(a,{emit:p}){const d=a,i=p,o=k(null),e=t=>{i("onSelect",t),o.value=null},r=t=>{var s;if(d.isOpen)switch(t.key){case"ArrowUp":b();break;case"ArrowDown":m();break;case"Enter":c();break;case"Escape":(s=document.activeElement)==null||s.blur();break}},m=()=>{o.value===null?o.value=0:o.value<d.autoCompleteData.length-1?o.value+=1:o.value>=d.autoCompleteData.length-1&&(o.value=d.autoCompleteData.length-1);const t=document.querySelector(".selected");t&&t.scrollIntoView({block:"start"})},b=()=>{o.value===null?o.value=d.autoCompleteData.length-1:o.value>0?o.value-=1:o.value<=0&&(o.value=0);const t=document.querySelector(".selected");t&&t.scrollIntoView({block:"end"})},c=()=>{o.value!==null&&e(d.autoCompleteData[o.value])};return E(()=>{window.addEventListener("keydown",r)}),fe(()=>{window.removeEventListener("keydown",r)}),(t,s)=>(u(),f("div",{class:A(["datalist",a.position]),style:be(a.autoCompleteStyle)},[l("ul",null,[a.autoCompleteData.length===0?(u(),f("li",xe,"No results")):$("",!0),(u(!0),f(q,null,T(a.autoCompleteData,(C,V)=>(u(),f("li",{key:C.value,class:A({selected:V===o.value})},[l("button",{onMousedown:P=>e(C)},_(C.label),41,Ee)],2))),128))])],6))}}),oe=I(Ie,[["__scopeId","data-v-13f98420"]]),Ue={class:"autocomplete-container"},Le={class:"label"},Oe={class:"buttons"},qe=["path"],Ae=["path"],Be=x({__name:"AutoCompleteInput",props:{label:{type:String,required:!0},autoCompletePosition:{type:String,required:!1,default:"bottom"},autoCompleteData:{type:Array,required:!1,default:()=>[]},select:{type:String,default:"value",required:!1}},emits:["selected"],setup(a,{emit:p}){const d={maxHeight:"100px",border:"1px solid var(--primary)"},i={maxHeight:"0",border:"none"},o=a,e=p,r=k(""),m=k(i),b=k([]),c=k(!1),t=k(!1),s=M=>{r.value=M.label,c.value=!0;const U=o.select==="label"?M.label:M.value;e("selected",U)},C=()=>{r.value="",c.value=!1,e("selected")},V=()=>{t.value=!0,m.value=d},P=()=>{t.value=!1,m.value=i},z=()=>{b.value=o.autoCompleteData.filter(M=>M.label.toLowerCase().includes(r.value.toLowerCase()))};return E(()=>{b.value=o.autoCompleteData}),(M,U)=>(u(),f("div",Ue,[a.autoCompleteData.length>0&&a.autoCompletePosition==="top"?(u(),w(oe,{key:0,"auto-complete-data":b.value,"auto-complete-style":m.value,"is-open":t.value,position:a.autoCompletePosition,select:a.select,onOnSelect:s},null,8,["auto-complete-data","auto-complete-style","is-open","position","select"])):$("",!0),c.value?(u(),f("div",{key:2,class:"valid-data-container",onClick:C},[l("span",null,_(r.value),1),l("svg-icon",{type:"mdi",path:R(te)},null,8,Ae)])):(u(),f("div",{key:1,class:A(["input-container",a.autoCompletePosition])},[l("label",Le,[se(l("input",{class:"input",type:"text",placeholder:"toto","onUpdate:modelValue":U[0]||(U[0]=W=>r.value=W),onInput:z,onFocus:V,onBlur:P},null,544),[[ke,r.value]]),l("span",null,_(a.label),1)]),l("div",Oe,[r.value?(u(),f("button",{key:0,onClick:C},[l("svg-icon",{type:"mdi",path:R(te)},null,8,qe)])):$("",!0)])],2)),a.autoCompleteData.length>0&&a.autoCompletePosition==="bottom"?(u(),w(oe,{key:3,"auto-complete-data":b.value,"auto-complete-style":m.value,"is-open":t.value,position:a.autoCompletePosition,select:a.select,onOnSelect:s},null,8,["auto-complete-data","auto-complete-style","is-open","position","select"])):$("",!0)]))}}),Te=I(Be,[["__scopeId","data-v-2f71ee1a"]]),Pe=["id","value","disabled"],je=["for"],Fe=x({__name:"CheckboxComponent",props:Ce({id:{type:String,required:!0},value:{type:String,required:!0},disabled:{type:Boolean,default:!1},initialValue:{type:Boolean,default:!1}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(a){const p=a;E(()=>{d.value=p.initialValue});const d=_e(a,"modelValue");return(i,o)=>(u(),f("div",{class:A(["checkbox-container",{checked:d.value}])},[se(l("input",{type:"checkbox",id:a.id,"onUpdate:modelValue":o[0]||(o[0]=e=>d.value=e),value:a.value,disabled:a.disabled},null,8,Pe),[[ge,d.value]]),l("label",{for:a.id},[ye(i.$slots,"default",{},()=>[O(_(a.id),1)],!0)],8,je)],2))}}),Q=I(Fe,[["__scopeId","data-v-3578e4c3"]]),Ge=a=>(ne("data-v-35c6a573"),a=a(),de(),a),He={class:"form"},ze=Ge(()=>l("h3",null,"Create this resource on other nodes :",-1)),We={class:"checkbox-list"},Ye={class:"label-container"},Je=x({__name:"CreateResourceModalComponent",props:{node:{type:Object,required:!0}},emits:["closeModal"],setup(a,{emit:p}){const d=a,i=p,o=De(),e=k({}),r=k([]),m=b=>{if(!b){i("closeModal",!1);return}const c=[];if(e.value.command||c.push("command"),e.value.name||c.push("name"),c.length>0){y.addWarning(`Some attributes are mandatory : ${c.join(", ")}`);return}const t=r.value.filter(s=>s.checked);if(t.length===0){y.addWarning("You must select at least one node to create this resource");return}e.value.addresses=t.filter(s=>!s.url.isNode(d.node)).map(s=>s.url.url),i("closeModal",!0,e.value)};return E(()=>{r.value=o.getNodeUrls().map(b=>({url:b,checked:!1}))}),(b,c)=>(u(),w(K,{class:"modal",headerText:"Create a resource",onCloseModal:m},{default:S(()=>[l("div",He,[g(H,{modelValue:e.value.name,"onUpdate:modelValue":c[0]||(c[0]=t=>e.value.name=t),label:"Name"},null,8,["modelValue"]),g(H,{modelValue:e.value.command,"onUpdate:modelValue":c[1]||(c[1]=t=>e.value.command=t),label:"Command"},null,8,["modelValue"]),ze,l("div",We,[(u(!0),f(q,null,T(r.value,t=>(u(),w(Q,{key:t.url.hash,modelValue:t.checked,"onUpdate:modelValue":s=>t.checked=s,value:t.url.hash,id:t.url.hash,disabled:t.url.isNode(a.node),"initial-value":t.url.isNode(a.node)},{default:S(()=>[l("div",Ye,[l("span",null,_(t.url.name),1),l("span",null,_(t.url.url),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","value","id","disabled","initial-value"]))),128))])])]),_:1}))}}),Ke=I(Je,[["__scopeId","data-v-35c6a573"]]),Qe={key:0,class:"loading-modal"},Xe={class:"label-container"},Ze=x({__name:"DeleteResourceModalComponent",props:{resource:{type:Object,required:!0},node:{type:Object,required:!0}},emits:["closeModal"],setup(a,{emit:p}){const d=J(),i=a,o=p,e=k(!1),r=k(),m=b=>{var t;if(!b){o("closeModal",!1);return}const c=((t=r.value)==null?void 0:t.filter(s=>s.node.id!==i.node.id).filter(s=>s.checked).map(s=>s.node.address))??[];o("closeModal",!0,i.resource.id,c)};return E(()=>{e.value=!0,d.fetchResourceOccurences(i.resource.id).then(()=>{r.value=d.occurences(i.resource.id),e.value=!1})}),(b,c)=>(u(),w(K,{class:"modal",headerText:"On which node do you want to delete this resource?",onCloseModal:m},{default:S(()=>[e.value?(u(),f("div",Qe,[g(G,{label:"Loading nodes"})])):(u(!0),f(q,{key:1},T(r.value,t=>(u(),f("div",{key:t.node.id,class:"checkbox-list"},[g(Q,{value:t.node.id,id:t.node.id,modelValue:t.checked,"onUpdate:modelValue":s=>t.checked=s,disabled:t.node.id===a.node.id,"initial-value":t.node.id===a.node.id},{default:S(()=>[l("div",Xe,[l("span",null,_(t.node.name),1),l("span",null,_(t.node.address),1)])]),_:2},1032,["value","id","modelValue","onUpdate:modelValue","disabled","initial-value"])]))),128))]),_:1}))}}),et=I(Ze,[["__scopeId","data-v-d02abdcd"]]),tt={key:0,class:"loading-modal"},at={key:1,class:"form"},lt={class:"checkbox-list"},ot={class:"label-container"},st=x({__name:"EditResourceModalComponent",props:{resource:{type:Object,required:!0},node:{type:Object,required:!0}},emits:["closeModal"],setup(a,{emit:p}){const d=a,i=p,o=J(),e=k(!1),r=k(""),m=k(),b=c=>{var s;if(!c){i("closeModal",!1);return}const t=new Me;t.command=r.value,t.addresses=((s=m.value)==null?void 0:s.filter(C=>C.node.id!==d.node.id).filter(C=>C.checked).map(C=>C.node.address))??[],i("closeModal",!0,t)};return E(()=>{e.value=!0,o.fetchResourceOccurences(d.resource.id).then(()=>{m.value=o.occurences(d.resource.id),e.value=!1})}),(c,t)=>(u(),w(K,{class:"modal",headerText:"Edit resource",onCloseModal:b},{default:S(()=>[e.value?(u(),f("div",tt,[g(G,{label:"Loading nodes"})])):(u(),f("div",at,[g(H,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s),label:"Command"},null,8,["modelValue"]),l("h3",null,'Edit resource "'+_(a.resource.name)+'" on other nodes :',1),l("div",lt,[(u(!0),f(q,null,T(m.value,s=>(u(),w(Q,{key:s.node.id,modelValue:s.checked,"onUpdate:modelValue":C=>s.checked=C,value:s.node.id,id:s.node.id,disabled:s.node.id===a.node.id,"initial-value":s.node.id===a.node.id},{default:S(()=>[l("div",ot,[l("span",null,_(s.node.name),1),l("span",null,_(s.node.address),1)])]),_:2},1032,["modelValue","onUpdate:modelValue","value","id","disabled","initial-value"]))),128))])]))]),_:1}))}}),nt=I(st,[["__scopeId","data-v-85111d62"]]);class Y{static async ping(p,d){const i=`${p.address}${this.url}`;try{const o=await fetch(i,{method:"GET",headers:{addresses:d.map(r=>r.address.toString()).join(",")}}),e=await o.json();if(o.ok){const r=[];for(const m of d)r.push({node:m,reachable:e.results[m.address.toString()]});return{reachable:e.reachable,results:r}}throw new Error(e.message)}catch(o){return console.error(`Error pinging node ${p.name} at ${i}: ${o}`),{reachable:!1,results:[]}}}}ee(Y,"url","/api/ping");const X=a=>(ne("data-v-83d8480d"),a=a(),de(),a),dt={class:"page"},ut={class:"page-header"},rt={class:"left"},it={class:"node-address"},ct={class:"right"},mt={class:"page-content"},vt={class:"content-header"},pt=X(()=>l("span",null,"Resources",-1)),ht={class:"table-container"},ft={"aria-label":"List of resources with last update"},bt=X(()=>l("thead",null,[l("tr",null,[l("th",null,"Name"),l("th",null,"Last update"),l("th",null,"Actions")])],-1)),kt=["onClick"],Ct={class:"actions"},_t=["onClick","disabled"],gt=["path"],yt=["onClick","disabled"],St=["path"],wt={key:0},Vt={colspan:"3",style:{position:"relative",height:"200px"}},$t={key:1,class:"no-data"},Mt=X(()=>l("td",{colspan:"3"},[l("span",null,"No resources found")],-1)),Nt=[Mt],Dt={class:"page-footer"},Rt=x({__name:"NodeView",setup(a){const p=Se(),d=we(),i=Re(),o=J(),e=F(()=>{const n=p.params.id;if(!(!n||Array.isArray(n)))return i.getNodeById(n)}),{nodesName:r}=ae(i),m=k(),b=F(()=>{var n;return o.resources(((n=e.value)==null?void 0:n.id)??"")??[]}),c=k(!1),t=k(),s=k(),C=k(!1),V=k(""),P=n=>{var v;d.push({name:"resource",params:{nodeId:(v=e.value)==null?void 0:v.id,resourceId:n.id}})},z=n=>{if(!n){m.value=void 0;return}m.value=i.getNodeById(n)},M=()=>{!e.value||!m.value||Y.ping(e.value,[m.value]).then(n=>{n.results&&(n.results[0].reachable?y.addSuccess("Ping result",`${m.value.name} is reachable`):y.addError("Ping result",`${m.value.name} is unreachable`))})},U=()=>{if(!e.value)return;const{nodes:n}=ae(i);n.value&&Y.ping(e.value,n.value).then(v=>{if(v.results){const h=v.results.filter(D=>D.reachable).map(D=>D.node.name),N=v.results.filter(D=>!D.reachable).map(D=>D.node.name);h.length>0&&y.addSuccess("Ping result",`Reachable nodes: ${h.join(", ")}`),N.length>0&&y.addError("Ping result",`Unreachable nodes: ${N.join(", ")}`)}})},W=F(()=>!V.value||V.value.trim()===""?b.value:b.value.filter(n=>n.name.toLowerCase().includes(V.value.toLowerCase()))),j=F(()=>{var n,v,h,N;return((n=e.value)==null?void 0:n.state)===L.OFFLINE?{label:"Start node",disabled:!1,background:"green",actions:i.startNode}:((v=e.value)==null?void 0:v.state)===L.ONLINE?{label:"Stop node",disabled:!1,background:"red",actions:i.stopNode}:((h=e.value)==null?void 0:h.state)===L.STARTING?{label:"Starting...",disabled:!0,background:"yellow",actions:()=>{}}:((N=e.value)==null?void 0:N.state)===L.STOPPING?{label:"Stopping...",disabled:!0,background:"yellow",actions:()=>{}}:{label:"Unknown",disabled:!0,background:"cuisse",actions:()=>{y.addDev("Unknown state","This should not happen. You break the universe.")}}}),ue=n=>{s.value=n},re=(n,v,h)=>{s.value=void 0,n&&v&&o.deleteResource(e.value,v,h).then(()=>{y.addSuccess("Resource deleted")})},Z=n=>{if(!e.value){y.addError("Node not found"),d.push({name:"home"});return}c.value=!0,o.fetchResourcesForNode(e.value,n).then(()=>{c.value=!1})},ie=n=>{t.value=n},ce=(n,v)=>{const h=t.value;t.value=void 0,n&&v&&h&&o.updateResource(e.value,h,v).then(()=>{y.addSuccess("Resource updated")})},me=()=>{C.value=!0},ve=(n,v)=>{C.value=!1,n&&v&&o.createResource(e.value,v).then(()=>{y.addSuccess("Resource created")})};return E(()=>{i.fetchNodes().then(()=>{Z(!1)})}),(n,v)=>(u(),f("div",dt,[e.value?(u(),f(q,{key:0},[l("div",ut,[l("div",rt,[g(Ne,{items:[{label:"Nodes",route:{name:"home"}}],"last-item-label":e.value.name??"Unknown name"},null,8,["last-item-label"]),l("span",it,_(e.value.address),1)]),l("div",ct,[g(B,{disabled:e.value.state!==R(L).ONLINE,onClick:me},{default:S(()=>[O(" Create resource ")]),_:1},8,["disabled"]),g(B,{disabled:e.value.state!==R(L).ONLINE,onClick:v[0]||(v[0]=h=>Z(!0))},{default:S(()=>[O(" Refresh ")]),_:1},8,["disabled"]),g(B,{disabled:j.value.disabled,background:j.value.background,onClick:v[1]||(v[1]=h=>j.value.actions(e.value.id))},{default:S(()=>[O(_(j.value.label),1)]),_:1},8,["disabled","background"]),l("span",{class:A(e.value.state)},_(e.value.state),3)])]),l("div",mt,[l("div",vt,[pt,g(H,{label:"Search resources",modelValue:V.value,"onUpdate:modelValue":v[2]||(v[2]=h=>V.value=h)},null,8,["modelValue"])]),l("div",ht,[l("table",ft,[bt,l("tbody",null,[(u(!0),f(q,null,T(W.value,h=>(u(),f("tr",{key:h.name,onClick:N=>P(h),class:A({deleted:h.deleted})},[l("td",null,_(h.name),1),l("td",null,_(n.$filters.longDate(h.lastUpdate)),1),l("td",null,[l("div",Ct,[l("button",{"aria-label":"Edit resource",class:"edit",onClick:le(N=>ie(h),["stop"]),disabled:h.deleted},[l("svg-icon",{path:R(Ve),type:"mdi"},null,8,gt)],8,_t),l("button",{"aria-label":"Delete resource",class:"delete",onClick:le(N=>ue(h),["stop"]),disabled:h.deleted},[l("svg-icon",{path:R($e),type:"mdi"},null,8,St)],8,yt)])])],10,kt))),128)),b.value.length===0&&c.value?(u(),f("tr",wt,[l("td",Vt,[g(G,{label:"Loading resources"})])])):$("",!0),b.value.length===0&&!c.value?(u(),f("tr",$t,Nt)):$("",!0)])])])]),l("div",Dt,[g(Te,{label:"Node to ping","auto-complete-data":R(r),"auto-complete-position":"top",onSelected:z},null,8,["auto-complete-data"]),g(B,{disabled:!m.value,onClick:M},{default:S(()=>[O("Ping selected")]),_:1},8,["disabled"]),g(B,{onClick:U},{default:S(()=>[O("Ping all nodes")]),_:1})])],64)):(u(),w(G,{key:1,label:"Loading node"})),e.value&&s.value?(u(),w(et,{key:2,resource:s.value,node:e.value,onCloseModal:re},null,8,["resource","node"])):$("",!0),e.value&&t.value?(u(),w(nt,{key:3,resource:t.value,node:e.value,onCloseModal:ce},null,8,["resource","node"])):$("",!0),e.value&&C.value?(u(),w(Ke,{key:4,node:e.value,onCloseModal:ve},null,8,["node"])):$("",!0)]))}}),Bt=I(Rt,[["__scopeId","data-v-83d8480d"]]);export{Bt as default};
